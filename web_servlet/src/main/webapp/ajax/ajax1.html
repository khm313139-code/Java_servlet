<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ajax - 기초1</title>
</head>
<body>
<!--
	CRUD : C(create) - post, R(read) - get, U(updata) - put/patch, D(delete) - delete - 이거 사용하면 msa를 사용했다는 것
	Ajax : javascript를 이용한 동기(sync) - 무조건 순차적용, 비동기 통신(async) => 서버와 통신
	Ajax의 본질은 비동기 통신
	동기(sync) : 서버에서 순서대로 처리 진행 통신 => 은행시스템, ARS 전화통화
	비동기(async) : 무작위로 처리 진행 통신 => SMS, 키오스크
	Ajax => 일반적인 통신방법(POST, GET)
	Ajax => Restful-API, RestAPI, MSA(API 서버를 가동하는 것) => POST, GET, PUT, PATCH, DELETE
	
	200 - Read(POST, GET, PUT, PATCH)
	201 - create성공 (POST)
	204 - delete삭제성공 (DELETE)
	500 - 서버 error
	Ajax를 서로 통신하는 방법: 문자, xml, json(xml과 json은 서버쪽에서 어떻게 통신하느냐에 따라서 달라지는 것)
-->

<input type="button" value="클릭" onclick="ajax_load()">

</body>
<script>
	//원래는 js에 따로 만들어야 함
	var aj; //통신을 사용하는 변수
	function ajax_load(){
		
		
		function aaa(){
			//XMLHttpRequest(XHR) : 서버와 클라이언트가 서로 상호작용을 할 수 있도록 하는 통신 언어
			if(window.XMLHttpRequest){
				return new XMLHttpRequest(); // new가 붙으니 신규로 생성하겠다는 의미(xhr을 신규 생성)
			}
		}
		
		
		function bbb(){
			//aj.readyState => 요청에 대한 현재 상태값을 나타냅니다.
			if(aj.readyState==XMLHttpRequest.DONE && aj.status==200){ //request는 요청
				//responseText => 문자로만 핸들링
				//responseXML => backend에서 XML 형태로 응답을 보내줄 경우
				//this.response => backend에서 JSON 형태로 응답을 보내줄 경우 
				var result = this.response;
				htmlcode(result); //응답결과를 받겠다. / 서버에서 보내준 값을 출력
				//console.log(this.response);
			}
			else if(aj.status==402 || aj.status==403 || aj.status==500){  
				//500 뜨면 빽엔드 잘못 - 자바 코드 잘못 쓰면 500 뜸
				//404는 아니고 402 payment 맞음 
				alert("서버와 통신 오류 발생!!")
			}
		}
		
		function htmlcode(data){
			console.log(data);
		}
		
		aj = aaa(); //통신 함수를 생성
		aj.onreadystatechange = bbb; //여기서는 괄호 없음 - 변화가 되면 바로 작동 시킴
		//?data= 파라미터 값을 통신으로 get 전송
		//onreadystatechange : 통신 결과에 대한 return 역할
		aj.open("GET", "../web_ajax/ajax1.do?data=hong1111", true); //open("통신방법", "서버경로", 동기 또는 비동기)
		//true : 비동기, false : 동기
		aj.send(); //send : 최종 ajax 통신값을 실행
	}
	
</script>
</html>











